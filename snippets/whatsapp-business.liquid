{%- comment -%} WhatsApp Business button (snippet version) {%- endcomment -%}
{%- liquid
  assign enabled    = settings.whatsapp_business_enable | default: true
  assign visibility = settings.whatsapp_business_visibility | default: 'all'
  # accept either 'whatsapp_business_number' or legacy 'whatsapp_number'
  assign number_raw = settings.whatsapp_business_number | default: settings.whatsapp_number | default: ''
  assign number     = number_raw | remove: '+' | replace: ' ', ''
  assign btn_style  = settings.whatsapp_business_btn_style | default: 'btn-success'
  assign text       = settings.whatsapp_business_text | default: 'WhatsApp'
-%}

{%- if enabled and number != '' -%}
  {%- liquid
    assign show = false
    if visibility == 'all'
      assign show = true
    elsif visibility == 'mobile' and request.device_type == 'mobile'
      assign show = true
    elsif visibility == 'desktop' and request.device_type == 'desktop'
      assign show = true
    endif
  -%}
  {%- if show -%}
    <a href="https://wa.me/{{ number }}"
       target="_blank" rel="noopener"
       class="btn {{ btn_style }} whatsapp-business-btn"
       aria-label="WhatsApp">
      {{ text }}
    </a>
  {%- endif -%}
{%- endif -%}