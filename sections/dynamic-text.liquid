{% comment %}
---------------------------------------------------------
Copyright © 2019/2024 Theme Shopiweb Premium. Tous droits réservés.
La copie, la modification, la distribution ou l'utilisation
non autorisée de ce code ou de toute partie de celui-ci est formellement interdite.
Les contrevenants seront poursuivis dans toute la mesure permise par la loi.
---------------------------------------------------------
{% endcomment %}

{% liquid
    assign pt = section.settings.pt | prepend: 'pt-'
    assign pb = section.settings.pb | prepend: 'pb-'
    assign mt = section.settings.mt | prepend: 'mt-'
    assign mb = section.settings.mb | prepend: 'mb-'

    assign bg_color = section.settings.bg_color

    if section.settings.bg_gradient
        assign bg_color = bg_color | append: ' bg-gradient'
    endif
%}

{% style %}
#dynamic-{{ section.id }} .text-3d {
  text-shadow:
    0 1px 0 #CCC,
    0 2px 0 #CCC,
    0 3px 0 #CCC,
    0 4px 0 #CCC,
    0 5px 0 #CCC,
    0 6px 0 transparent,
    0 7px 0 transparent,
    0 8px 10px rgba(0, 0, 0, 0.4);
}

#dynamic-{{ section.id }} .text-flaming {
  text-shadow: 0 -1px 4px #FFF, 0 -2px 10px #ff0, 0 -10px 20px #ff8000, 0 -18px 40px #F00;
  margin-top: 0.75rem!important;
}

#dynamic-{{ section.id }} .text-distant {
  text-shadow: 1px 3px 0 #969696, 1px 13px 5px #aba8a8;
}
{% endstyle %}

<section 
    id="dynamic-{{ section.id }}" 
    class="dynamic {{ bg_color }} {{ pt }} {{ pb }} {{ mt }} {{ mb }}">
    <div class="text-center">
          <{{ section.settings.heading_tag }} class="{{ section.settings.text_style }} {{ section.settings.title_size }}">
            <strong>{{ section.settings.title }}</strong>
            <span style="color:{{ section.settings.color_typewriter_text }};" class="typewrite title {{ section.settings.title_size }}" data-period="2000" data-type='[ {{ section.settings.typewriter_text }} ]'>
              <span class="wrap"></span>
            </span>
          </{{ section.settings.heading_tag }}>
    </div>
</section>

{% schema %}
{
  "name": "Dynamic Text",
  "settings": [
    {
      "type": "paragraph",
      "content": "Documentation EN: [Dynamic Text by Shopiweb](https://www.docs.shopiweb.fr/theme-premium/documentation/sections/texte-dynamique)"
    },
    {
      "type": "header",
      "content": "General"
    },
    {
      "type": "select",
      "id": "bg_color",
      "label": "Background color",
      "default": "bg-body text-body",
      "options": [
        {
          "group": "Main",
          "value": "bg-primary text-white",
          "label": "Primary"
        },
        {
          "group": "Principal",
          "value": "bg-secondary text-white",
          "label": "Secondary"
        },
        {
          "group": "Principal",
          "value": "bg-tertiary text-white",
          "label": "Tertiary"
        },
        {
          "group": "Intermediate",
          "value": "bg-white text-dark",
          "label": "White"
        },
        {
          "group": "Intermédiaire",
          "value": "bg-light text-body",
          "label": "Light"
        },
        {
          "group": "Intermédiaire",
          "value": "bg-dark text-white",
          "label": "Dark"
        },
        {
          "group": "Default",
          "value": "bg-body text-body",
          "label": "Body"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "bg_gradient",
      "label": "Background gradient",
      "default": false,
      "info": "Does not apply to light colors"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Avec Shopiweb PREMIUM vous pouvez :"
    },
    {
      "type": "select",
      "id": "text_style",
      "label": "Title style",
      "default": "",
      "options": [
        {
          "value": "",
          "label": "Normal"
        },
        {
          "value": "text-flaming",
          "label": "Flame"
        },
        {
          "value": "text-3d",
          "label": "3D"
        },
        {
          "value": "text-distant",
          "label": "Distant"
        }
      ]
    },
    {
      "type": "select",
      "id": "heading_tag",
      "label": "Title tag (SEO)",
      "default": "h2",
      "options": [
        {
          "value": "h1",
          "label": "h1"
        },
        {
          "value": "h2",
          "label": "h2"
        },
        {
          "value": "h3",
          "label": "h3"
        },
        {
          "value": "h4",
          "label": "h4"
        },
        {
          "value": "h5",
          "label": "h5"
        },
        {
          "value": "h6",
          "label": "h6"
        },
        {
          "value": "span",
          "label": "None"
        }
      ]
    },
    {
      "type": "select",
      "id": "title_size",
      "label": "Title size",
      "default": "h2",
      "options": [
        {
          "group": "Large Title",
          "value": "display-1",
          "label": "Extra Extra Large"
        },
        {
          "group": "Titre Supérieur",
          "value": "display-2",
          "label": "Extra Large"
        },
        {
          "group": "Titre Supérieur",
          "value": "display-3",
          "label": "Ultra Large"
        },
        {
          "group": "Titre Supérieur",
          "value": "display-4",
          "label": "Super Large"
        },
        {
          "group": "Standard Title",
          "value": "h1",
          "label": "Very Large"
        },
        {
          "group": "Titre Standard",
          "value": "h2",
          "label": "Large"
        },
        {
          "group": "Titre Standard",
          "value": "h3",
          "label": "Medium"
        },
        {
          "group": "Titre Standard",
          "value": "h4",
          "label": "Small"
        },
        {
          "group": "Titre Standard",
          "value": "h5",
          "label": "Very Small"
        },
        {
          "group": "Titre Standard",
          "value": "h6",
          "label": "Super Small"
        }
      ]
    },
    {
      "type": "textarea",
      "id": "typewriter_text",
      "label": "Dynamic text",
      "default": "\"Booster les conversions.\", \"Stimuler vos ventes.\", \"Proposer une valeur unique.\"",
      "info": "Please add text in JSON format. Example: \"Boost conversions.\", \"Increase your sales.\", \"Offer unique value.\""
    },
    {
      "type": "color",
      "id": "color_typewriter_text",
      "label": "Dynamic text color",
      "default": "#F56900"
    },
    {
      "type": "header",
      "content": "Section spacing"
    },
    {
      "type": "range",
      "id": "pt",
      "label": "Top padding",
      "min": 0,
      "max": 20,
      "step": 1,
      "default": 0
    },
    {
      "type": "range",
      "id": "pb",
      "label": "Bottom padding",
      "min": 0,
      "max": 20,
      "step": 1,
      "default": 0
    },
    {
      "type": "range",
      "id": "mt",
      "label": "Top margin",
      "min": 0,
      "max": 20,
      "step": 1,
      "default": 0
    },
    {
      "type": "range",
      "id": "mb",
      "label": "Bottom margin",
      "min": 0,
      "max": 20,
      "step": 1,
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "Dynamic Text"
    }
  ]
}
{% endschema %}

{% javascript %}

 var TxtType = function(el, toRotate, period) {
        this.toRotate = toRotate;
        this.el = el;
        this.loopNum = 0;
        this.period = parseInt(period, 10) || 2000;
        this.txt = '';
        this.tick();
        this.isDeleting = false;
    };

    TxtType.prototype.tick = function() {
        var i = this.loopNum % this.toRotate.length;
        var fullTxt = this.toRotate[i];

        if (this.isDeleting) {
        this.txt = fullTxt.substring(0, this.txt.length - 1);
        } else {
        this.txt = fullTxt.substring(0, this.txt.length + 1);
        }

        this.el.innerHTML = '<span class="wrap">'+this.txt+'</span>';

        var that = this;
        var delta = 200 - Math.random() * 100;

        if (this.isDeleting) { delta /= 2; }

        if (!this.isDeleting && this.txt === fullTxt) {
        delta = this.period;
        this.isDeleting = true;
        } else if (this.isDeleting && this.txt === '') {
        this.isDeleting = false;
        this.loopNum++;
        delta = 500;
        }

        setTimeout(function() {
        that.tick();
        }, delta);
    };

    window.onload = function() {
        var elements = document.getElementsByClassName('typewrite');
        for (var i=0; i<elements.length; i++) {
            var toRotate = elements[i].getAttribute('data-type');
            var period = elements[i].getAttribute('data-period');
            if (toRotate) {
              new TxtType(elements[i], JSON.parse(toRotate), period);
            }
        }
        // INJECT CSS
        var css = document.createElement("style");
        css.type = "text/css";
        css.innerHTML = ".typewrite > .wrap { border-right: 0.08em solid #fff}";
        document.body.appendChild(css);
    };

{% endjavascript %}
