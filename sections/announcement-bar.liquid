{% comment %}
---------------------------------------------------------
Copyright ¬© 2019/2024 Theme Shopiweb Premium. Tous droits r√©serv√©s.
La copie, la modification, la distribution ou l'utilisation
non autoris√©e de ce code ou de toute partie de celui-ci est formellement interdite.
Les contrevenants seront poursuivis dans toute la mesure permise par la loi.
---------------------------------------------------------
{% endcomment %}

{% liquid 
    assign pt = section.settings.pt | prepend: 'pt-'
    assign pb = section.settings.pb | prepend: 'pb-'

    assign bg_color = section.settings.bg_color

    if section.settings.bg_gradient
        assign bg_color = bg_color | append: ' bg-gradient'
    endif
%}

{% assign expiration_time = section.settings.expiration_time | date: '%s' %}


{% if section.settings.homepage == false or template.name == 'index' %}
    <section 
        id="announcement-bar-{{ section.id }}" 
        class="announcement-bar enter-view {{ bg_color }} {{ section.settings.font_size }} {{ section.settings.text_transform }} {% if section.settings.sticky %}sticky-announcement-bar{% endif %}"
        {% if section.settings.expiration_time  != blank %}
          data-expiration-time="{{ expiration_time }}"
        {% endif %}>
        <div 
            class="animate__animated animate__fast opacity-0"
            data-animate-class="animate__fadeInDown">
            <div 
  id="carousel-{{ section.id }}" 
  class="carousel slide container-fluid mx-auto {% if bg_color contains 'text-dark' %}carousel-dark{% endif %}" 
  data-bs-ride="{% if section.settings.autoplay %}carousel{% else %}false{% endif %}">
                <div class="carousel-inner w-100 text-center">Shipping throughout Europe (EEA)
                    {% for block in section.blocks %}
                        {% capture countdown_timer %}
                            {% if block.settings.countdown_timer == blank %}
                            {% else %}
                            {% assign block_expiration_time = block.settings.countdown_timer | date: '%s' %}
                                <span class="visually-hidden">
                                    {{ 'general.countdown_timer.expires' | t }}
                                </span>
                                <ul 
                                    class="timer-countdown list-unstyled" 
                                    data-time="{{ block_expiration_time }}"
                                    data-text-d="{{ 'general.countdown_timer.d' | t }}"
                                    data-text-h="{{ 'general.countdown_timer.h' | t }}"
                                    data-text-m="{{ 'general.countdown_timer.m' | t }}"
                                    data-text-s="{{ 'general.countdown_timer.s' | t }}"
                                    data-text-days="{{ 'general.countdown_timer.days' | t }}"
                                    data-text-hours="{{ 'general.countdown_timer.hours' | t }}"
                                    data-text-minutes="{{ 'general.countdown_timer.minutes' | t }}"
                                    data-text-seconds="{{ 'general.countdown_timer.seconds' | t }}"
                                    hidden>
                                    <li data-days></li>
                                    <li data-hours></li>
                                    <li data-minutes></li>
                                    <li data-seconds></li>
                                </ul>
                            {% endif %}
                        {% endcapture %}
                        <div 
                            class="carousel-item {% if forloop.first == true %}active{% endif %}" 
                            data-index="{{ forloop.index0 }}"
                            {{ block.shopify_attributes }}>
                            {% if block.settings.url == blank %}
                                <div class="rte text-center lh-sm {{ pt }} {{ pb }}">
                                    {{ block.settings.description }}
                                    {{ countdown_timer }}
                                </div>
                            {% else %}
                                <a href="{{ block.settings.url }}" class="{{ pt }} {{ pb }}">
                                    <div class="rte text-center lh-sm {{ pt }} {{ pb }}">
                                        {{ block.settings.description }}
                                        <svg xmlns="http://www.w3.org/2000/svg" class="ms-2" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M5 12h13M12 5l7 7-7 7"/>
                                        </svg>
                                        {{ countdown_timer }}
                                    </div>
                                </a>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
                {% if section.settings.controls and section.blocks.size > 1 %}
                    <button 
                        class="carousel-control carousel-control-prev" 
                        type="button" 
                        data-bs-target="#carousel-{{ section.id }}" 
                        data-bs-slide="prev">
                        <span class="carousel-control-icon carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">
                            {{ 'general.accessibility.previous' | t }}
                        </span>
                    </button>
                    <button 
                        class="carousel-control carousel-control-next" 
                        type="button" 
                        data-bs-target="#carousel-{{ section.id }}" 
                        data-bs-slide="next">
                        <span class="carousel-control-icon carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">
                            {{ 'general.accessibility.next' | t }}
                        </span>
                    </button>
                {% endif %}
            </div>
        </div>
    </section>
{% endif %}

{% unless section.settings.expiration_time == blank %}
    <script>
        const section = document.querySelector('#announcement-bar-{{ section.id }}')

        let expirationTime = section.dataset.expirationTime
        
        if (expirationTime.length) {
            expirationTime = Number(expirationTime)
        
            if (expirationTime <= Date.now() / 1000) {
                section.remove()
            }
        }
    </script>
{% endunless %}

{% schema %}
{
  "name": "üèÜ Announcement Bar",
  "settings": [
    {
      "type": "header",
      "content": "üèÜ Announcement Bar App",
      "info": "üëâ Shopiweb Premium App Version"
    },
    {
      "type": "paragraph",
      "content": "Documentation EN: [Announcement Bar by Shopiweb](https://www.docs.shopiweb.fr/theme-premium/documentation/sections/announcement-bar)"
    },
    {
      "type": "header",
      "content": "General"
    },
    {
      "type": "checkbox",
      "id": "homepage",
      "label": "Show only on homepage",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "sticky",
      "label": "Stick to top (Sticky)",
      "default": false
    },
    {
      "type": "select",
      "id": "bg_color",
      "label": "Background color",
      "default": "bg-dark text-white",
      "options": [
        {
          "group": "Main",
          "value": "bg-primary text-white",
          "label": "Primary"
        },
        {
          "group": "Main",
          "value": "bg-secondary text-white",
          "label": "Secondary"
        },
        {
          "group": "Main",
          "value": "bg-tertiary text-white",
          "label": "Tertiary"
        },
        {
          "group": "Intermediate",
          "value": "bg-white text-dark",
          "label": "White"
        },
        {
          "group": "Intermediate",
          "value": "bg-light text-body",
          "label": "Light"
        },
        {
          "group": "Intermediate",
          "value": "bg-dark text-white",
          "label": "Dark"
        },
        {
          "group": "Default",
          "value": "bg-body text-body",
          "label": "Body"
        },
        {
          "group": "Alert",
          "value": "bg-success text-white",
          "label": "Success"
        },
        {
          "group": "Alert",
          "value": "bg-warning text-dark",
          "label": "Warning"
        },
        {
          "group": "Alert",
          "value": "bg-danger text-white",
          "label": "Danger"
        },
        {
          "group": "Alert",
          "value": "bg-info text-white",
          "label": "Info"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "bg_gradient",
      "label": "Background gradient",
      "default": false,
      "info": "Does not apply to light colors"
    },
    {
      "type": "text",
      "id": "max_width",
      "label": "Maximum width (px)",
      "default": "600"
    },
    {
      "type": "select",
      "id": "font_size",
      "label": "Text size",
      "default": "fs-6",
      "options": [
        {
          "value": "",
          "label": "Normal"
        },
        {
          "value": "fs-6",
          "label": "Small"
        }
      ]
    },
    {
      "type": "select",
      "id": "text_transform",
      "label": "Text transform",
      "default": "text-capitalize",
      "options": [
        {
          "value": "",
          "label": "Normal"
        },
        {
          "value": "text-capitalize",
          "label": "Capitalize"
        },
        {
          "value": "text-lowercase",
          "label": "Lowercase"
        },
        {
          "value": "text-uppercase",
          "label": "Uppercase"
        }
      ]
    },
    {
      "type": "text",
      "id": "expiration_time",
      "label": "Expiration date",
      "info": "Completely hide the announcement bar section if this time is reached using the following format: 2024-03-17 11h10am. Leave blank to disable."
    },
    {
      "type": "header",
      "content": "Carousel",
      "info": "Will not display if you publish only one slide"
    },
    {
      "type": "checkbox",
      "id": "controls",
      "label": "Arrows",
      "info": "Previous/Next buttons",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay",
      "info": "Every 5 seconds",
      "default": true
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "pt",
      "label": "Top margin",
      "min": 0,
      "max": 6,
      "step": 1,
      "default": 3
    },
    {
      "type": "range",
      "id": "pb",
      "label": "Bottom margin",
      "min": 0,
      "max": 6,
      "step": 1,
      "default": 3
    }
  ],
  "blocks": [
    {
      "type": "Announcement",
      "name": "Announcement",
      "settings": [
        {
          "type": "header",
          "content": "üèÜ Announcement Block",
          "info": "üëâ Shopiweb Premium Block Version"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Link"
        },
        {
          "type": "header",
          "content": "üèÜ Countdown App",
          "info": "üëâ Shopiweb Premium App Version"
        },
        {
          "type": "text",
          "id": "countdown_timer",
          "label": "Countdown",
          "info": "Display an animated countdown using the following format: 2024-03-17 11h10am. Leave blank to disable."
        }
      ]
    }
  ]
}
{% endschema %}