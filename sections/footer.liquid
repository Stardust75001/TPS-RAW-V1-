{% comment %}
Footer section – version corrigée (JSON schema valide)
- Fix: bg_color initialisé + option gradient
- Fix: structure UL/LI correcte pour les blocks
- Fix: placements des </div> et commentaires
{% endcomment %}

{% liquid
  assign pt = section.settings.pt | prepend: 'pt-'
  assign pb = section.settings.pb | prepend: 'pb-'
  assign bg_color = section.settings.bg_color
  if section.settings.bg_gradient
    assign bg_color = bg_color | append: ' bg-gradient'
  endif

  assign about_bg_color = section.settings.about_bg_color
  if section.settings.about_bg_gradient
    assign about_bg_color = about_bg_color | append: ' bg-gradient'
  endif
  if section.settings.about_bg_transparent
    assign about_bg_color = about_bg_color | append: ' bg-transparent'
  endif

  assign btn_shadow_sp = settings.btn_shadow_sp
%}

{% style %}
/* Image2 SVG */
.navbar-brand svg { width: {{ section.settings.logo_svg_height }}%; }
{% endstyle %}

<footer id="footer" class="{{ bg_color }} {{ pt }} {{ pb }}">
  <div class="footer-logo-wrapper d-flex justify-content-center align-items-center">

    {% if section.settings.show_about_area %}
      <div class="footer-about py-4 {{ about_bg_color }}">
        {%- if section.settings.about_logo != blank -%}
    <img src="{{ section.settings.about_logo | image_url: width: 300 }}"
      alt="{{ shop.name }}" width="300" height="auto" class="img-fluid mb-3" loading="lazy">
        {%- endif -%}

        {%- unless section.settings.svg_logo_footer == blank -%}
          <div class="mb-3">{{ section.settings.svg_logo_footer }}</div>
        {%- endunless -%}

        {%- unless section.settings.about_description == blank -%}
          <div class="rte small mb-2">{{ section.settings.about_description }}</div>
        {%- endunless -%}

        {%- if section.settings.about_phone_text != blank -%}
          <div class="small"><a href="{{ section.settings.about_phone_url | default: '' }}">{{ section.settings.about_phone_text }}</a></div>
        {%- endif -%}
        {%- if section.settings.about_email_text != blank -%}
          <div class="small"><a href="{{ section.settings.about_email_url | default: '' }}">{{ section.settings.about_email_text }}</a></div>
        {%- endif -%}
        {%- if section.settings.about_adresse_text != blank -%}
          <div class="small">{{ section.settings.about_adresse_text }}</div>
        {%- endif -%}
      </div>
    {% endif %}

    {% if settings.logo %}
      <ul id="footer-blocks" class="row mb-10 list-unstyled">
        {% for block in section.blocks %}
          <li class="footer-block col-lg" {{ block.shopify_attributes }}>
            <a class="nav-link h6 collapsed d-lg-none"
               href="#block-collapse-{{ block.id }}"
               data-bs-toggle="collapse"
               aria-expanded="false"
               aria-controls="block-collapse-{{ block.id }}"
               role="button">
              {{ block.settings.title }}
            </a>

            <h3 class="title d-none d-lg-inline-block {{ block.settings.title_size }}">
              <span>{{ block.settings.title }}</span>
            </h3>

            <div id="block-collapse-{{ block.id }}" class="collapse d-lg-block">
              <div class="mt-4 mb-6 my-lg-0">
                {% if block.type == 'newsletter' %}

                  {% unless block.settings.description == blank %}
                    <div class="rte mt-2 mb-3 small">{{ block.settings.description }}</div>
                  {% endunless %}

                  {% form 'customer' %}
                    <input type="hidden" name="contact[tags]" value="newsletter">
                    {{ form.errors | default_errors }}
                    {% if form.posted_successfully? %}
                      <p class="alert alert-success">{{ 'general.newsletter.confirmation_text' | t }}</p>
                    {% endif %}

                    <div class="newsletter-form">
                      <div class="newsletter-input-row">
                        <input type="text"
                               name="contact[first_name]"
                               class="form-control form-control-sm newsletter-name-input"
                               placeholder="{{ 'general.newsletter.name_placeholder' | t }}"
                               aria-label="{{ 'general.newsletter.name_placeholder' | t }}"
                               autocorrect="off" autocapitalize="words">

                        <input type="email"
                               name="contact[email]"
                               class="form-control form-control-sm newsletter-email-input"
                               value="{% if customer.email != blank %}{{ customer.email }}{% endif %}"
                               placeholder="{{ 'general.newsletter.input_label' | t }}"
                               aria-label="{{ 'general.newsletter.input_label' | t }}"
                               autocorrect="off" autocapitalize="off">
                      </div>

                      <button class="btn btn-sm {{ block.settings.btn_color }} {{ btn_shadow_sp }} {{ block.settings.btn_size }}"
                              type="submit" name="commit">
                        {{ 'general.newsletter.submit_button' | t }}
                      </button>
                    </div>

                    {% unless block.settings.notice == blank %}
                      <div class="notice rte mt-3 lh-sm extra-small text-center">{{ block.settings.notice }}</div>
                    {% endunless %}
                  {% endform %}

                {% else %}
                  {% case block.type %}
                    {% when 'richtext' %}
                      {% unless block.settings.description == blank %}
                        <div class="rte mt-2 small">{{ block.settings.description }}</div>
                      {% endunless %}
                      {% unless block.settings.btn_text == blank %}
                        <a class="btn btn-sm w-100 mt-6 {{ block.settings.btn_color }} {{ btn_shadow_sp }} {{ block.settings.btn_size }}"
                           href="{{ block.settings.btn_url }}">{{ block.settings.btn_text }}</a>
                      {% endunless %}

                    {% when 'menu' %}
                      <ul class="nav flex-column mb-0">
                        {% for link in linklists[block.settings.menu].links %}
                          {% if link.title != ':' %}
                            <li class="nav-item">
                              <a class="nav-link px-0 py-3 py-lg-2" href="{{ link.url }}">{{ link.title }}</a>
                            </li>
                          {% endif %}
                        {% endfor %}
                      </ul>

                    {% when 'image' %}
                      {% unless block.settings.description == blank %}
                        <div class="rte mt-2 mb-5 small">{{ block.settings.description }}</div>
                      {% endunless %}
                      {% if block.settings.image_footer != blank %}
                        {% assign image_height_2x = block.settings.image_footer_height | times: 2 %}
                        <div class="image-footer-wrapper">
                          <a class="d-flex align-items-center" href="{{ block.settings.image_link_url }}">
                            <img class="img-fluid mx-auto d-block rounded mt-4"
                                 src="{{ block.settings.image_footer | image_url: height: image_height_2x }}"
                                 alt="{{ shop.name }}"
                                 width="{{ block.settings.image_footer_height | times: block.settings.image_footer.aspect_ratio | round }}"
                                 height="{{ block.settings.image_footer_height }}"
                                 loading="lazy">
                          </a>
                        </div>
                      {% else %}
                        {{ 'detailed-apparel-1' | placeholder_svg_tag: 'placeholder-svg rounded' }}
                      {% endif %}
                  {% endcase %}
                {% endif %}
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% endif %}

  </div><!-- /.footer-logo-wrapper -->

  {% if section.settings.language_selector_show or section.settings.currency_selector_show %}
    {% if localization.available_languages.size > 1 or shop.enabled_currencies.size > 1 %}
      <div class="d-flex justify-content-center py-2 mx-4 mt-4 mt-lg-2 mb-2 mb-lg-0">
        {% if section.settings.language_selector_show %}
          {% render 'dropdown-localization', btn_color: section.settings.lang_currency_btn_color %}
        {% endif %}
        {% if section.settings.currency_selector_show %}
          {% render 'dropdown-currency', btn_color: section.settings.lang_currency_btn_color %}
        {% endif %}
      </div>
    {% endif %}
  {% endif %}
</footer>

{% schema %}
{
  "name": "Footer",
  "settings": [
    { "type": "select", "id": "bg_color", "label": "Couleur de fond", "default": "", "options": [
      { "value": "", "label": "Body" },
      { "value": "bg-light", "label": "Light" },
      { "value": "bg-dark text-white", "label": "Dark" }
    ]},
    { "type": "checkbox", "id": "bg_gradient", "label": "Dégradé de fond", "default": false },

    { "type": "checkbox", "id": "language_selector_show", "label": "Afficher sélecteur de langue", "default": true },
    { "type": "checkbox", "id": "currency_selector_show", "label": "Afficher sélecteur de devise", "default": true },
    { "type": "select", "id": "lang_currency_btn_color", "label": "Couleur bouton langue/devise", "default": "btn-outline-info", "options": [
      { "value": "btn-outline-light", "label": "Contour Clair" },
      { "value": "btn-outline-dark", "label": "Contour Sombre" },
      { "value": "btn-outline-primary", "label": "Contour Primaire" },
      { "value": "btn-outline-secondary", "label": "Contour Secondaire" },
      { "value": "btn-outline-info", "label": "Contour Info" }
    ]},

    { "type": "header", "content": "À propos de nous" },
    { "type": "checkbox", "id": "show_about_area", "label": "Afficher la zone \"À propos\"", "default": true },
    { "type": "select", "id": "about_bg_color", "label": "Couleur fond zone À propos", "default": "bg-dark text-white", "options": [
      { "value": "bg-primary text-white", "label": "Primaire" },
      { "value": "bg-secondary text-white", "label": "Secondaire" },
      { "value": "bg-tertiary text-white", "label": "Tertiaire" },
      { "value": "bg-white text-dark", "label": "White" },
      { "value": "bg-light text-dark", "label": "Light" },
      { "value": "bg-dark text-white", "label": "Dark" },
      { "value": "", "label": "Body" }
    ]},
    { "type": "checkbox", "id": "about_bg_gradient", "label": "Dégradé de fond (À propos)", "default": false, "info": "Ne s'applique pas aux couleurs claires" },
    { "type": "checkbox", "id": "about_bg_transparent", "label": "Arrière-plan transparent (À propos)", "default": false },
    { "type": "image_picker", "id": "about_logo", "label": "Logo" },
    { "type": "range", "id": "about_logo_height", "label": "Taille du logo image", "min": 20, "max": 100, "step": 2, "default": 40 },

    { "type": "header", "content": "SVG Logo" },
    { "type": "html", "id": "svg_logo_footer", "label": "Logo SVG (recommandé)" },
    { "type": "range", "id": "logo_svg_height", "label": "Taille du logo SVG (%)", "min": 1, "max": 100, "step": 1, "default": 50 },

    { "type": "richtext", "id": "about_description", "label": "Description" },
    { "type": "text", "id": "about_phone_text", "label": "Numéro de téléphone", "default": "+33769238799" },
    { "type": "url", "id": "about_phone_url", "label": "Lien téléphone (tel:...)" },
    { "type": "text", "id": "about_email_text", "label": "Adresse e-mail", "default": "hello@thepetsociety.paris" },
    { "type": "url", "id": "about_email_url", "label": "Lien adresse e-mail" },
    { "type": "text", "id": "about_adresse_text", "label": "Adresse", "default": "229 rue Saint Honoré - 75001 PARIS" },

    { "type": "header", "content": "Espacements" },
    { "type": "range", "id": "pt", "label": "Top padding", "min": 0, "max": 20, "step": 1, "default": 10 },
    { "type": "range", "id": "pb", "label": "Bottom padding", "min": 0, "max": 20, "step": 1, "default": 10 }
      ,
      { "type": "header", "content": "WhatsApp Business" },
      { "type": "checkbox", "id": "whatsapp_business_enable", "label": "Afficher le bouton WhatsApp Business", "default": true },
      { "type": "text", "id": "whatsapp_business_number", "label": "Numéro WhatsApp Business", "default": "+33769238799" },
      { "type": "text", "id": "whatsapp_business_text", "label": "Texte du bouton", "default": "Contactez-nous sur WhatsApp" },
      { "type": "select", "id": "whatsapp_business_btn_style", "label": "Style du bouton", "default": "btn-success", "options": [
        { "value": "btn-success", "label": "Vert" },
        { "value": "btn-primary", "label": "Bleu" },
        { "value": "btn-outline-success", "label": "Contour Vert" }
      ] },
      { "type": "select", "id": "whatsapp_business_visibility", "label": "Visibilité", "default": "all", "options": [
        { "value": "all", "label": "Tous" },
        { "value": "mobile", "label": "Mobile uniquement" },
        { "value": "desktop", "label": "Desktop uniquement" }
      ] }
  ],

  "blocks": [
    {
      "type": "richtext",
      "name": "Texte",
      "settings": [
        { "type": "text", "id": "title", "label": "Titre" },
        { "type": "select", "id": "title_size", "label": "Taille du titre", "default": "h6", "options": [
          { "value": "h1", "label": "Very Large" },
          { "value": "h2", "label": "Large" },
          { "value": "h3", "label": "Medium" },
          { "value": "h4", "label": "Small" },
          { "value": "h5", "label": "Very Small" },
          { "value": "h6", "label": "Super Petit" }
        ]},
        { "type": "richtext", "id": "description", "label": "Description" },
        { "type": "text", "id": "btn_text", "label": "Texte du bouton" },
        { "type": "url", "id": "btn_url", "label": "URL du bouton" },
        { "type": "select", "id": "btn_color", "label": "Couleur du bouton", "default": "btn-primary", "options": [
          { "value": "btn-link", "label": "Link" },
          { "value": "btn-light", "label": "Light" },
          { "value": "btn-dark", "label": "Dark" },
          { "value": "btn-primary", "label": "Primaire" },
          { "value": "btn-secondary", "label": "Secondaire" },
          { "value": "btn-tertiary", "label": "Tertiaire" },
          { "value": "btn-success", "label": "Success" },
          { "value": "btn-danger", "label": "Danger" },
          { "value": "btn-warning", "label": "Avertissement" },
          { "value": "btn-info", "label": "Info" },
          { "value": "btn-outline-light", "label": "Contour Clair" },
          { "value": "btn-outline-dark", "label": "Contour Sombre" },
          { "value": "btn-outline-primary", "label": "Contour Primaire" },
          { "value": "btn-outline-secondary", "label": "Contour Secondaire" },
          { "value": "btn-outline-tertiary", "label": "Contour Tertiaire" },
          { "value": "btn-outline-success", "label": "Success Outline" },
          { "value": "btn-outline-danger", "label": "Contour Danger" },
          { "value": "btn-outline-warning", "label": "Contour Avertissement" },
          { "value": "btn-outline-info", "label": "Contour Info" }
        ]},
        { "type": "select", "id": "btn_size", "label": "Taille du bouton", "default": "btn-sm", "options": [
          { "value": "btn-sm", "label": "Small" },
          { "value": "btn-md", "label": "Normal" },
          { "value": "btn-lg", "label": "Large" }
        ]}
      ]
    },

    {
      "type": "menu",
      "name": "Menu",
      "settings": [
        { "type": "link_list", "id": "menu", "label": "Menu" },
        { "type": "text", "id": "title", "label": "Titre" },
        { "type": "select", "id": "title_size", "label": "Taille du titre", "default": "h6", "options": [
          { "value": "h1", "label": "Very Large" },
          { "value": "h2", "label": "Large" },
          { "value": "h3", "label": "Medium" },
          { "value": "h4", "label": "Small" },
          { "value": "h5", "label": "Very Small" },
          { "value": "h6", "label": "Super Petit" }
        ]}
      ]
    },

    {
      "type": "image",
      "name": "Image",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "title", "label": "Titre" },
        { "type": "select", "id": "title_size", "label": "Taille du titre", "default": "h6", "options": [
          { "value": "h1", "label": "Very Large" },
          { "value": "h2", "label": "Large" },
          { "value": "h3", "label": "Medium" },
          { "value": "h4", "label": "Small" },
          { "value": "h5", "label": "Very Small" },
          { "value": "h6", "label": "Super Petit" }
        ]},
        { "type": "richtext", "id": "description", "label": "Description" },
        { "type": "image_picker", "id": "image_footer", "label": "Image" },
        { "type": "range", "id": "image_footer_height", "label": "Hauteur de l'image", "min": 20, "max": 200, "step": 2, "default": 100 },
        { "type": "url", "id": "image_link_url", "label": "URL de l'image" }
        ]
    },

    {
      "type": "newsletter",
      "name": "Newsletter",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "title", "label": "Titre", "default": "Newsletter" },
        { "type": "select", "id": "title_size", "label": "Taille du titre", "default": "h6", "options": [
          { "value": "h1", "label": "Very Large" },
          { "value": "h2", "label": "Large" },
          { "value": "h3", "label": "Medium" },
          { "value": "h4", "label": "Small" },
          { "value": "h5", "label": "Very Small" },
          { "value": "h6", "label": "Super Petit" }
        ]},
        { "type": "richtext", "id": "description", "label": "Description" },
        { "type": "select", "id": "btn_color", "label": "Couleur du bouton", "default": "btn-primary", "options": [
          { "value": "btn-link", "label": "Link" },
          { "value": "btn-primary", "label": "Primaire" },
          { "value": "btn-secondary", "label": "Secondaire" },
          { "value": "btn-dark", "label": "Dark" },
          { "value": "btn-outline-info", "label": "Contour Info" }
        ]},
        { "type": "select", "id": "btn_size", "label": "Taille du bouton", "default": "btn-sm", "options": [
          { "value": "btn-sm", "label": "Small" },
          { "value": "btn-md", "label": "Normal" },
          { "value": "btn-lg", "label": "Large" }
        ]},
        { "type": "richtext", "id": "notice", "label": "Notice", "default": "<p>En vous inscrivant, vous acceptez nos CGV et notre politique de confidentialité.</p>" }
      ]
    }
  ],

  "presets": [
    { "name": "Footer", "category": "Footer" }
  ]
}
{% endschema %}